<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b1220" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />

  <title>Today (DEBUG)</title>

  <link rel="manifest" href="./manifest.json" />
  <link rel="icon" href="./today-icon-v9-192.png" />
  <link rel="apple-touch-icon" href="./apple-touch-icon-v9.png" />

  <style>
    :root{
      --bg0:#0b1220; --bg1:#0b1220;
      --card:rgba(255,255,255,.08);
      --stroke:rgba(255,255,255,.10);
      --text:#eef2ff;
      --muted:rgba(238,242,255,.62);
      --btn:#ffffff; --btnText:#0b1220;
      --shadow:0 20px 60px rgba(0,0,0,.35);
      --radius:24px;

      --rK:#101626; --rB:#2f6bff; --rR:#ff3b30; --rG:#34c759; --rY:#ffcc00;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      font-family:-apple-system,BlinkMacSystemFont,system-ui,Segoe UI,Roboto,Helvetica,Arial;
      color:var(--text);
      background:
        radial-gradient(1100px 800px at 50% 15%, rgba(255,255,255,.10), transparent 55%),
        radial-gradient(900px 700px at 10% 90%, rgba(120,170,255,.10), transparent 55%),
        linear-gradient(180deg,var(--bg0),var(--bg1));
      -webkit-font-smoothing:antialiased;
      -webkit-tap-highlight-color: transparent;
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
    }
    .wrap{ min-height:100vh; display:flex; align-items:center; justify-content:center; padding:24px; }
    .screen{
      width:min(460px, 94vw);
      background:var(--card);
      border:1px solid var(--stroke);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .inner{ padding:26px; }
    .title{ text-align:center; letter-spacing:.14em; font-weight:800; font-size:34px; margin:6px 0 6px; }
    .sub{ text-align:center; color:var(--muted); font-size:14px; margin:0 0 18px; line-height:1.35; }
    .mini{ color:var(--muted); font-size:12px; }
    .btn{
      width:100%;
      border:0;
      border-radius:18px;
      padding:16px 18px;
      background:var(--btn);
      color:var(--btnText);
      font-weight:800;
      font-size:18px;
      cursor:pointer;
      position:relative;
      z-index:10;
      pointer-events:auto;
    }
    .btn:active{ transform:scale(.99); }

    /* Debug: hiçbir katman tıklamayı yutmasın */
    .wrap,.screen,.inner{ pointer-events:auto !important; }

    [data-view]{ display:none; }
    [data-view].show{ display:block; }

    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border:1px solid var(--stroke);
      border-radius:999px; color:var(--muted); font-size:13px; user-select:none;
    }
    .q{ text-align:center; font-weight:700; font-size:18px; margin:12px 0 16px; }

    .choices{ display:flex; flex-direction:column; gap:10px; }
    .choice{
      display:flex; gap:12px; align-items:flex-start;
      padding:14px; border:1px solid var(--stroke);
      border-radius:18px; background:rgba(255,255,255,.04);
      cursor:pointer; user-select:none;
    }
    .radio{ width:18px; height:18px; border-radius:50%; border:2px solid rgba(255,255,255,.35); margin-top:2px; }
    .choice.selected .radio{ background:var(--text); border-color:var(--text); }
    .ctitle{ font-weight:800; }
    .cdesc{ color:var(--muted); font-size:13px; margin-top:4px; line-height:1.3; }

    .row2{ display:flex; justify-content:space-between; align-items:center; gap:10px; margin-top:14px; }
    .linkBtn{
      border:1px solid var(--stroke);
      background:transparent;
      color:var(--text);
      border-radius:14px;
      padding:12px 12px;
      font-weight:800;
      cursor:pointer;
      user-select:none;
    }
    .status{ text-align:center; font-size:13px; color:var(--muted); min-height:18px; margin-top:10px; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="screen">

      <!-- HOME -->
      <div class="inner show" data-view="home">
        <div class="title">TODAY</div>
        <div class="sub">verileriniz sadece bu cihazda kaydedilmektedir.</div>

        <!-- build etiketi: doğru dosya mı yayınlanıyor hemen anlarsın -->
        <div class="mini" style="text-align:center;opacity:.75;margin-bottom:14px">
          build: v10-DEBUG-001
        </div>

        <button class="btn" id="btnStart" type="button">Başla</button>
        <div class="status" id="statusHome"></div>
      </div>

      <!-- PICK -->
      <div class="inner" data-view="pick">
        <div class="pill" id="pillDate">—</div>
        <div class="q">Bugün sende ne oldu?</div>

        <div class="choices" id="choices">
          <div class="choice" data-choice="A">
            <div class="radio"></div>
            <div>
              <div class="ctitle">Bir şey oldu ama adı yok</div>
              <div class="cdesc">Adını koyma. Sadece fark et.</div>
            </div>
          </div>
          <div class="choice" data-choice="B">
            <div class="radio"></div>
            <div>
              <div class="ctitle">Her şey çok net</div>
              <div class="cdesc">Bir cümleyle söyleyebiliyorsan tamam.</div>
            </div>
          </div>
          <div class="choice" data-choice="C">
            <div class="radio"></div>
            <div>
              <div class="ctitle">Zordu bugün</div>
              <div class="cdesc">zorluklar olgunlaşma için gereklidir</div>
            </div>
          </div>
        </div>

        <div class="row2">
          <button class="linkBtn" id="btnBackHome" type="button">← Home</button>
          <div class="status" id="statusPick"></div>
        </div>
      </div>

    </div>
  </div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const $ = (s, r=document) => r.querySelector(s);
  const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));

  // DEBUG: Service Worker KAPALI (cache karışmasın)
  // if ("serviceWorker" in navigator) navigator.serviceWorker.register("./sw.js");

  const showView = (name) => {
    $$("[data-view]").forEach(v => v.classList.remove("show"));
    $(`[data-view="${name}"]`).classList.add("show");
  };

  const pad2 = n => String(n).padStart(2,"0");
  const todayKey = () => {
    const d=new Date();
    return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
  };
  const parseKey = (k) => {
    const [y,m,d]=k.split("-").map(Number);
    return new Date(y,m-1,d);
  };
  const prettyTR = (k) => parseKey(k).toLocaleDateString("tr-TR",{day:"2-digit",month:"long",year:"numeric"});

  const LS_KEY = "today_data_v10";
  const load = () => {
    try{ return JSON.parse(localStorage.getItem(LS_KEY) || '{"v":10,"days":{}}'); }
    catch{ return {v:10,days:{}}; }
  };
  const save = () => localStorage.setItem(LS_KEY, JSON.stringify(state));
  let state = load();
  if(!state.days) state.days = {};

  const dayObj = (k) => state.days[k] || (state.days[k] = { choice:"" });

  // ✅ Başla tıklaması: önce alert ile tık kesin mi görelim
  $("#btnStart").addEventListener("click", () => {
    alert("Başla tıklandı ✅ (build: v10-DEBUG-001)");
    const k = todayKey();
    $("#pillDate").textContent = prettyTR(k);
    dayObj(k);
    save();
    showView("pick");
  });

  $("#btnBackHome").addEventListener("click", () => showView("home"));

  $$("#choices .choice").forEach(el => {
    el.addEventListener("click", () => {
      const k = todayKey();
      const o = dayObj(k);
      o.choice = el.dataset.choice;
      save();
      $$("#choices .choice").forEach(x => x.classList.remove("selected"));
      el.classList.add("selected");
      $("#statusPick").textContent = "Kaydedildi.";
      setTimeout(()=>$("#statusPick").textContent="", 900);
    });
  });

  showView("home");
});
</script>
</body>
</html>