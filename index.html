<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#F4F5F6" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <title>TODAY</title>

  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icon-192.png" />
  <link rel="apple-touch-icon" href="icon-192.png" />

  <style>
    :root{
      --bg:#F4F5F6;
      --ink:#1C1F24;
      --softShadow: rgba(0,0,0,.06);
      --hardShadow: rgba(0,0,0,.10);
      --lighten: rgba(255,255,255,.22);
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      background:var(--bg);
      color:var(--ink);
      font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","SF Pro Display",system-ui;
    }
    .wrap{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px 16px;
    }
    .card{
      width:min(520px, 100%);
      text-align:center;
    }
    h1{
      margin:0;
      font-size:28px;
      font-weight:600;
      letter-spacing:.5px;
    }
    .q{
      margin:28px 0 22px;
      font-size:20px;
    }
    .list{
      display:flex;
      flex-direction:column;
      gap:14px;
    }
    .row{
      text-align:left;
      padding:12px 16px;
      border-radius:14px;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .dot::before{
      content:"●";
      margin-right:10px;
    }
    .overlay{
      position:fixed;
      inset:0;
      pointer-events:none;
      opacity:0;
      transition: opacity 160ms ease-out;
    }
    .overlay.on{ opacity:1; }
  </style>
</head>
<body>

  <div class="wrap">
    <div class="card">
      <h1>TODAY</h1>
      <div class="q">Bugün sende ne oldu?</div>

      <div class="list">
        <div class="row dot" id="unnamed">Bir şey oldu ama adı yok</div>
        <div class="row dot" id="clear">Netti</div>
        <div class="row dot" id="nothing">Hiçbir şey olmadı</div>
      </div>
    </div>
  </div>

  <div class="overlay" id="overlay"></div>

  <script>
    const overlay = document.getElementById("overlay");

    function flash(color, inMs, peakOpacity, outMs){
      overlay.style.background = color;
      overlay.style.transition = `opacity ${inMs}ms ease-out`;
      overlay.style.opacity = peakOpacity;
      overlay.classList.add("on");
      setTimeout(()=>{
        overlay.style.transition = `opacity ${outMs}ms ease-in`;
        overlay.style.opacity = 0;
        setTimeout(()=> overlay.classList.remove("on"), outMs);
      }, inMs);
    }

    function highlight(el, style){
      el.style.background = style;
      setTimeout(()=>{ el.style.background = "transparent"; }, 600);
    }

    document.getElementById("unnamed").onclick = e => {
      highlight(e.target, "var(--softShadow)");
      flash("rgba(0,0,0,1)", 350, 0.28, 550);
    };
    document.getElementById("clear").onclick = e => {
      highlight(e.target, "var(--hardShadow)");
      flash("rgba(0,0,0,1)", 120, 0.35, 250);
    };
    document.getElementById("nothing").onclick = e => {
      highlight(e.target, "var(--lighten)");
      flash("rgba(255,255,255,1)", 180, 0.22, 400);
    };
  </script>
  <script>
    // iOS audio wake-up (first user interaction)
let audioUnlocked = false;
document.addEventListener("touchend", () => {
  if (audioUnlocked) return;
  try {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    g.gain.value = 0.0001;
    o.connect(g);
    g.connect(ctx.destination);
    o.start(0);
    o.stop(0.01);
    audioUnlocked = true;
  } catch (_) {}
}, { once: true });
  const overlay = document.getElementById("overlay");

  // --- FEEDBACK LAYER (vibration + micro sound) ---

  // Android/Chrome: vibration; iPhone/Safari çoğu zaman kısıtlar
  function haptic(pattern) {
    try {
      if ("vibrate" in navigator) navigator.vibrate(pattern);
    } catch (_) {}
  }

  // iPhone için "tok" his: mikro ses (çok kısa)
  // iOS'ta ses sadece kullanıcı etkileşimi sonrası çalar; tıklama zaten var.
  let audioCtx;
  function clickTone(freq = 160, durationMs = 18, volume = 0.07, type = "sine") {
    try {
      audioCtx = audioCtx || new (window.AudioContext || window.webkitAudioContext)();

      // Bazı iOS sürümlerinde context askıda kalabilir
      if (audioCtx.state === "suspended") audioCtx.resume().catch(() => {});

      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();

      o.type = type;              // "sine" daha yumuşak, "triangle" daha tok
      o.frequency.value = freq;

      // Gain envelope: klik hissi
      const now = audioCtx.currentTime;
      g.gain.setValueAtTime(0.0001, now);
      g.gain.exponentialRampToValueAtTime(volume, now + 0.005);
      g.gain.exponentialRampToValueAtTime(0.0001, now + durationMs / 1000);

      o.connect(g);
      g.connect(audioCtx.destination);

      o.start(now);
      o.stop(now + durationMs / 1000);
    } catch (_) {}
  }

  // --- VISUAL LAYER (overlay close-feel + row highlight) ---

  function flash(color, inMs, peakOpacity, outMs) {
    overlay.style.background = color;
    overlay.style.transition = `opacity ${inMs}ms ease-out`;
    overlay.style.opacity = peakOpacity;
    overlay.classList.add("on");

    setTimeout(() => {
      overlay.style.transition = `opacity ${outMs}ms ease-in`;
      overlay.style.opacity = 0;
      setTimeout(() => overlay.classList.remove("on"), outMs);
    }, inMs);
  }

  function highlight(el, cssVar) {
    el.style.background = `var(${cssVar})`;
    setTimeout(() => { el.style.background = "transparent"; }, 600);
  }

  // --- CHOICES ---

  // 1) Bir şey oldu ama adı yok → yumuşak + gecikmeli his + yavaş kararma
  document.getElementById("unnamed").onclick = (e) => {
    const el = e.currentTarget;
    highlight(el, "--softShadow");

    // vibration: uzun-kısa pattern (android)
    haptic([20, 60, 20, 120]);

    // micro sound: derin ve biraz uzun (iPhone'da "içeriden" his)
    clickTone(95, 38, 0.065, "sine");

    flash("rgba(0,0,0,1)", 350, 0.28, 550);
  };

  // 2) Netti → tok + keskin + hard kapanış
  document.getElementById("clear").onclick = (e) => {
    const el = e.currentTarget;
    highlight(el, "--hardShadow");

    // vibration: tek, net darbeli
    haptic([45]);

    // micro sound: kısa, tok (triangle daha "tık" gibi)
    clickTone(175, 16, 0.085, "triangle");

    flash("rgba(0,0,0,1)", 120, 0.35, 250);
  };

  // 3) Hiçbir şey olmadı → neredeyse yok + beyazlaşma
  document.getElementById("nothing").onclick = (e) => {
    const el = e.currentTarget;
    highlight(el, "--lighten");

    // vibration: çok hafif
    haptic([12]);

    // micro sound: çok hafif, kısa (istersen tamamen kapatabiliriz)
    clickTone(220, 12, 0.035, "sine");

    flash("rgba(255,255,255,1)", 180, 0.22, 400);
  };
</script>
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("./sw.js").catch(() => {});
      });
    }
  </script>
</body>
</html>
